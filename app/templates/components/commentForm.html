<!-- Comment Form -->
<div class="card mb-4">
    <div class="card-body">
        <div id="post-sno" style="display: none">{{ post.sno }}</div>
        <h5 class="card-title">Leave a Comment</h5>
        <form id="myForm">
            <div class="mb-3">
                <textarea id="commentText" class="form-control" rows="4" placeholder="Join the discussion..." required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Post Comment</button>
        </form>
    </div>
</div>

<script>    
    // JavaScript code to handle the comment form submission
    document.getElementById('myForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        // Get the comment text and post ID
        const commentText = document.getElementById('commentText').value.trim();
        const postSno = document.getElementById('post-sno').textContent;
        
        // Validate comment text
        if (!commentText) {
            alert('Please enter a comment');
            return;
        }

        // Create form data
        const formData = new FormData();
        formData.append('comment', commentText);
        formData.append('post_sno', postSno);

        try {
            // Send the comment to the server
            const response = await fetch('/api/comment', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: formData
            });
            
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            
            const data = await response.json();
            
            if (data.success) {
                alert('Comment posted successfully!');
                document.getElementById('commentText').value = '';
                // Optionally reload the page to show the new comment
                window.location.reload();
            } else {
                alert('Error posting comment: ' + data.message);
            }
        }
        catch (error) {
            console.error('There was a problem with the fetch operation:', error);
            alert('Error posting comment. Please try again.');
        }
    });
</script>